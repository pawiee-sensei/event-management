<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Events</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f9fafb;
      color: #1e293b;
      padding: 30px;
    }

    h1 {
      margin-bottom: 10px;
      color: #1e293b;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    a.btn {
      background: #2563eb;
      color: white;
      text-decoration: none;
      padding: 8px 14px;
      border-radius: 8px;
      transition: background 0.2s ease;
    }

    a.btn:hover {
      background: #1d4ed8;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      overflow: hidden;
      margin-top: 20px;
    }

    th, td {
      padding: 14px 16px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
    }

    th {
      background: #f1f5f9;
      color: #374151;
      font-weight: 600;
    }

    tr.event-row {
      cursor: pointer;
      transition: background 0.2s ease;
    }

    tr.event-row:hover {
      background: #f9fafb;
    }

    /* Smooth collapse animation container */
    .event-details {
      height: 0;
      overflow: hidden;
      background: #f8fafc;
      border-top: 1px solid #e5e7eb;
      transition: height 0.35s ease, opacity 0.3s ease;
      opacity: 0;
    }

    .event-details.active {
      opacity: 1;
      height: auto;
    }

    .details-frame {
      display: flex;
      align-items: flex-start;
      gap: 25px;
      padding: 25px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      background: white;
      margin: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .details-text {
      flex: 2;
      line-height: 1.6;
    }

    .details-text p {
      margin: 8px 0;
    }

    .details-image {
      flex: 1;
      text-align: center;
    }

    .details-image img {
      width: 100%;
      max-width: 480px;
      border-radius: 8px;
      border: 2px solid #e5e7eb;
      transition: transform 0.3s ease;
    }

    .details-image img:hover {
      transform: scale(1.05);
    }

    .approved { color: #16a34a; font-weight: 600; }
    .pending { color: #ca8a04; font-weight: 600; }
    .rejected { color: #dc2626; font-weight: 600; }

    .reject-note {
      margin-top: 8px;
      font-size: 0.9em;
      color: #991b1b;
      background: #fff5f5;
      border-left: 4px solid #dc2626;
      padding: 8px 10px;
      border-radius: 6px;
      line-height: 1.4;
    }

    .no-events {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <h1>My Events</h1>
    <div>
      <a class="btn" href="/organizer/dashboard">← Back to Dashboard</a>
      <a class="btn" href="/organizer/events/new">+ New Event</a>
      <a class="btn" href="/organizer/logout" style="background:#dc2626;">Logout</a>
    </div>
  </div>

  <% if (events.length === 0) { %>
    <div class="no-events">
      <p>No events yet. Create one to get started!</p>
    </div>
  <% } else { %>
    <table>
      <thead>
        <tr>
          <th>Title</th>
          <th>Date</th>
          <th>Category</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        <% events.forEach(ev => { %>
          <tr class="event-row" data-event-id="<%= ev.id %>">
            <td><%= ev.title %></td>
            <td><%= ev.date %></td>
            <td><%= ev.category || '—' %></td>
            <td>
              <% if (ev.status === 'pending') { %>
                <span class="pending">Pending</span>
              <% } else if (ev.status === 'approved') { %>
                <span class="approved">Approved</span>
              <% } else if (ev.status === 'rejected') { %>
                <span class="rejected">Rejected</span>
              <% } %>
            </td>
          </tr>

          <tr>
            <td colspan="4">
              <div class="event-details" id="details-<%= ev.id %>">
                <div class="details-frame">
                  <div class="details-text">
                    <p><strong>Description:</strong> <%= ev.description %></p>
                    <p><strong>Location:</strong> <%= ev.location %></p>
                    <p><strong>Date & Time:</strong> <%= ev.date %> at <%= ev.time %></p>
                    <p><strong>Category:</strong> <%= ev.category || 'N/A' %></p>
                    
                    <% if (ev.proof) { %>
                      <p><strong>Proof Document:</strong>
                        <a href="/uploads/proofs/<%= ev.proof %>" target="_blank">View Proof</a>
                      </p>
                    <% } else { %>
                      <p><em>No proof uploaded</em></p>
                    <% } %>

                    <% if (ev.status === 'rejected' && ev.rejection_reason) { %>
                      <div class="reject-note">
                        <p><strong>Reason:</strong> <%= ev.rejection_reason %></p>
                      </div>
                    <% } %>
                  </div>

                  <% if (ev.image) { %>
                    <div class="details-image">
                      <img src="/uploads/banners/<%= ev.image %>" alt="Event Banner">
                    </div>
                  <% } else { %>
                    <div class="details-image">
                      <img src="https://via.placeholder.com/400x220?text=No+Banner" alt="No Banner">
                    </div>
                  <% } %>
                </div>
              </div>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  <% } %>

  <script>
    // Smooth collapse logic
    const rows = document.querySelectorAll('.event-row');
    rows.forEach(row => {
      row.addEventListener('click', () => {
        const id = row.dataset.eventId;
        const details = document.getElementById(`details-${id}`);
        const active = details.classList.contains('active');

        // Collapse all
        document.querySelectorAll('.event-details').forEach(d => {
          d.classList.remove('active');
          d.style.height = '0';
        });

        // Expand clicked
        if (!active) {
          details.classList.add('active');
          details.style.height = details.scrollHeight + 'px';
        }
      });
    });
  </script>
</body>
</html>
